"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MatchLobbyPage = MatchLobbyPage;
var jsx_runtime_1 = require("hono/jsx/jsx-runtime");
require("../styles/Homepage.css");
function MatchLobbyPage(_a) {
    var c = _a.c, matchId = _a.matchId, currentUser = _a.currentUser;
    return ((0, jsx_runtime_1.jsxs)("div", { className: "min-h-screen bg-gradient-to-br from-neutral-950 via-neutral-900 to-green-950 p-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "max-w-3xl mx-auto", children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-4xl font-bold text-white mb-4 font-[Orbitron]", children: "Match Lobby" }), (0, jsx_runtime_1.jsxs)("p", { className: "text-neutral-400 mb-6", children: ["Match ID: ", matchId] }), (0, jsx_runtime_1.jsxs)("div", { id: "players", className: "bg-neutral-900/50 rounded-lg p-4 border border-neutral-800 mb-4", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg text-white mb-2", children: "Players" }), (0, jsx_runtime_1.jsx)("div", { id: "playersList", className: "space-y-2 text-neutral-200", children: (0, jsx_runtime_1.jsx)("div", { className: "text-neutral-400", children: "Loading players\u2026" }) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-3", children: [(0, jsx_runtime_1.jsxs)("form", { id: "startForm", action: "/v1/match/start", method: "post", className: "flex-1", children: [(0, jsx_runtime_1.jsx)("input", { type: "hidden", name: "matchId", value: matchId }), (0, jsx_runtime_1.jsx)("button", { id: "startBtn", disabled: true, className: "w-full py-3 bg-neutral-700/40 text-neutral-400 rounded-md cursor-not-allowed", children: "Start Match" })] }), (0, jsx_runtime_1.jsxs)("form", { id: "leaveForm", action: "/v1/match/leave", method: "post", className: "flex-1", children: [(0, jsx_runtime_1.jsx)("input", { type: "hidden", name: "matchId", value: matchId }), (0, jsx_runtime_1.jsx)("button", { type: "submit", className: "w-full py-3 bg-transparent border border-neutral-700 text-white rounded-md", children: "Leave" })] })] })] }), (0, jsx_runtime_1.jsx)("script", { dangerouslySetInnerHTML: {
                    __html: "\n(function(){\n  var matchId = ".concat(JSON.stringify(matchId), ";\n  var currentUser = ").concat(JSON.stringify(currentUser), ";\n  var decodedUser = (typeof currentUser === 'string' && currentUser.length) ? decodeURIComponent(currentUser) : currentUser;\n  var playersList = document.getElementById('playersList');\n  var startBtn = document.getElementById('startBtn');\n\n  function safeDecode(s){\n    try{\n      if(typeof s === 'string' && s.length){\n        return decodeURIComponent(s);\n      }\n    }catch(e){}\n    return s;\n  }\n\n  function renderPlayers(doc){\n    playersList.innerHTML = '';\n    const players = (doc.players || []);\n    players.forEach((p, idx) => {\n      const displayName = safeDecode(p.username) || p.id;\n      const div = document.createElement('div');\n      div.className = 'flex justify-between items-center bg-neutral-800/30 p-2 rounded';\n      div.innerHTML = '<div><div class=\"font-semibold text-white\">'+(displayName)+'</div><div class=\"text-xs text-neutral-400\">ELO: '+(p.elo||0)+' \u2014 Wins: '+(p.wins||0)+' \u2014 Losses: '+(p.loses||0)+'</div></div><div class=\"text-sm text-neutral-300\">#'+(idx+1)+'</div>';\n      playersList.appendChild(div);\n    });\n\n    if(players.length >= 4) {\n      startBtn.disabled = false;\n      startBtn.className = 'w-full py-3 bg-red-600 text-white rounded-md';\n    } else {\n      startBtn.disabled = true;\n      startBtn.className = 'w-full py-3 bg-neutral-700/40 text-neutral-400 rounded-md';\n    }\n  }\n\n  async function fetchState(){\n    try{\n      const res = await fetch('/v1/match/state?matchId=' + encodeURIComponent(matchId));\n      if(res.ok){\n        const doc = await res.json();\n        renderPlayers(doc);\n      }\n    }catch(e){ console.error(e); }\n  }\n\n  // initial load + polling\n  fetchState();\n  const poll = setInterval(fetchState, 2000);\n\n  // stop polling when navigating away\n  window.addEventListener('beforeunload', function(){ clearInterval(poll); });\n})();\n          "),
                } })] }));
}
