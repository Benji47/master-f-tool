"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MatchGamePage = MatchGamePage;
var jsx_runtime_1 = require("hono/jsx/jsx-runtime");
require("../styles/Homepage.css");
function MatchGamePage(_a) {
    var c = _a.c, match = _a.match;
    var players = match.players || [];
    var scores = match.scores || [];
    return ((0, jsx_runtime_1.jsxs)("div", { className: "min-h-screen bg-gradient-to-br from-neutral-950 via-neutral-900 to-green-950 p-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "max-w-4xl mx-auto", children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-4xl font-bold text-white mb-4 font-[Orbitron]", children: "Match Game" }), (0, jsx_runtime_1.jsxs)("p", { className: "text-neutral-400 mb-4", children: ["Match ID: ", match.$id] }), (0, jsx_runtime_1.jsxs)("div", { className: "bg-neutral-900/50 rounded-lg p-4 mb-6 border border-neutral-800", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg text-white mb-2", children: "Players" }), (0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-2 gap-2 text-sm text-neutral-200", children: players.map(function (p) { return ((0, jsx_runtime_1.jsxs)("div", { className: "p-2 bg-neutral-800/40 rounded", children: [(0, jsx_runtime_1.jsx)("div", { className: "font-semibold text-white", children: p.username }), (0, jsx_runtime_1.jsxs)("div", { className: "text-xs text-neutral-400", children: ["ELO: ", p.elo, " \u2014 W:", p.wins, " L:", p.loses] })] }, p.id)); }) })] }), (0, jsx_runtime_1.jsx)("div", { id: "pairings", className: "space-y-4", children: scores.map(function (s, idx) { return ((0, jsx_runtime_1.jsxs)("div", { className: "bg-neutral-900/50 rounded-lg p-4 border border-neutral-800 flex items-center justify-between", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col items-start gap-2 w-1/3", children: [(0, jsx_runtime_1.jsx)("div", { className: "font-semibold text-white", children: s.a.map(function (id, i) {
                                                var p = players.find(function (x) { return x.id === id; });
                                                return (0, jsx_runtime_1.jsxs)("span", { children: [p ? p.username : id, i < s.a.length - 1 ? ' / ' : ''] }, i);
                                            }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-600 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "10", children: "+10" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-500 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "5", children: "+5" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-400 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "1", children: "+1" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2 mt-1", children: [(0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-600 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "-10", children: "-10" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-500 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "-5", children: "-5" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-400 rounded text-sm", "data-idx": idx, "data-side": "a", "data-delta": "-1", children: "-1" })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-2xl font-bold text-white", children: [(0, jsx_runtime_1.jsx)("span", { id: "scoreA-".concat(idx), children: s.scoreA }), (0, jsx_runtime_1.jsx)("span", { className: "mx-4 text-neutral-400", children: ":" }), (0, jsx_runtime_1.jsx)("span", { id: "scoreB-".concat(idx), children: s.scoreB })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col items-end gap-2 w-1/3", children: [(0, jsx_runtime_1.jsx)("div", { className: "font-semibold text-white", children: s.b.map(function (id, i) {
                                                var p = players.find(function (x) { return x.id === id; });
                                                return (0, jsx_runtime_1.jsxs)("span", { children: [p ? p.username : id, i < s.b.length - 1 ? ' / ' : ''] }, i);
                                            }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-600 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "10", children: "+10" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-500 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "5", children: "+5" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-green-400 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "1", children: "+1" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2 mt-1", children: [(0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-600 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "-10", children: "-10" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-500 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "-5", children: "-5" }), (0, jsx_runtime_1.jsx)("button", { className: "px-3 py-1 bg-red-400 rounded text-sm", "data-idx": idx, "data-side": "b", "data-delta": "-1", children: "-1" })] })] })] }, idx)); }) }), (0, jsx_runtime_1.jsxs)("div", { className: "mt-6 flex gap-3", children: [(0, jsx_runtime_1.jsx)("a", { href: "/v1/match/lobby", className: "flex-1", children: (0, jsx_runtime_1.jsx)("button", { className: "w-full px-6 py-2 bg-neutral-800/60 hover:bg-neutral-800 text-white rounded-md", children: "\u2190 Back to Lobby" }) }), (0, jsx_runtime_1.jsxs)("form", { id: "finishForm", action: "/v1/match/game/finish", method: "post", className: "flex-1", children: [(0, jsx_runtime_1.jsx)("input", { type: "hidden", name: "matchId", value: match.$id }), (0, jsx_runtime_1.jsx)("button", { id: "finishBtn", type: "button", className: "w-full px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md", children: "Finish Match" })] })] })] }), (0, jsx_runtime_1.jsx)("script", { 
                // eslint-disable-next-line react/no-danger
                dangerouslySetInnerHTML: {
                    __html: "\n(function(){\n  const matchId = ".concat(JSON.stringify(match.$id), ";\n  async function sendUpdate(idx, side, delta){\n    try{\n      const form = new FormData();\n      form.append('matchId', matchId);\n      form.append('index', String(idx));\n      form.append('side', side);\n      form.append('delta', String(delta));\n      const res = await fetch('/v1/match/game/score', { method: 'POST', body: form });\n      if(!res.ok) {\n        const txt = await res.text().catch(()=>null);\n        console.error('score update failed', txt);\n        return;\n      }\n      const data = await res.json();\n      // update DOM scores\n      (data.scores || []).forEach((s, i) => {\n        const a = document.getElementById('scoreA-'+i);\n        const b = document.getElementById('scoreB-'+i);\n        if(a) a.textContent = String(s.scoreA);\n        if(b) b.textContent = String(s.scoreB);\n      });\n    }catch(e){ console.error(e); }\n  }\n\n  document.addEventListener('click', function(e){\n    const el = e.target;\n    if(!(el instanceof HTMLElement)) return;\n    const idx = el.getAttribute('data-idx');\n    const side = el.getAttribute('data-side');\n    const delta = el.getAttribute('data-delta');\n    if(idx && side && delta){\n      // optimistic client-side clamp (server also enforces)\n      const scoreEl = document.getElementById((side==='a'?'scoreA-':'scoreB-')+idx);\n      let cur = scoreEl ? Number(scoreEl.textContent || '0') : 0;\n      const newVal = Math.min(10, Math.max(0, cur + Number(delta)));\n      // send delta = newVal - cur\n      sendUpdate(Number(idx), side, newVal - cur);\n    }\n\n    // finish button\n    if(el.id === 'finishBtn'){\n      if(!confirm('Are you sure you want to finish the match and apply results? This is irreversible.')) return;\n      // submit finish form\n      const form = document.getElementById('finishForm');\n      form && form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));\n      // actually submit normally\n      form && form.submit();\n    }\n  });\n})();\n          "),
                } })] }));
}
